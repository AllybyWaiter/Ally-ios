<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!-- Google Fonts - Inter (preloaded for performance) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Preload critical hero images -->
    <link rel="preload" as="image" href="/images/dashboard/morning.jpg" media="(min-width: 768px)">
    
    <link rel="icon" type="image/png" href="/favicon.png" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/manifest.webmanifest" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="theme-color" content="#222222" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Ally" />

    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN" />
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />
    <meta http-equiv="Permissions-Policy" content="camera=(self), microphone=(self), geolocation=(self)" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.gpteng.co https://*.sentry.io https://www.googletagmanager.com https://connect.facebook.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com data:; img-src 'self' data: blob: https: http:; connect-src 'self' https://*.supabase.co wss://*.supabase.co https://*.sentry.io https://api.openweathermap.org https://*.lovableproject.com https://*.lovable.app https://www.google-analytics.com https://www.facebook.com; frame-ancestors 'self'; base-uri 'self'; form-action 'self';" />

    <!-- 
      ╔═══════════════════════════════════════════════════════════════════════╗
      ║  GOOGLE ANALYTICS 4 CONFIGURATION                                     ║
      ║  Get your Measurement ID from: https://analytics.google.com           ║
      ║  Navigate to: Admin → Data Streams → Web → Measurement ID             ║
      ║  Replace ALL instances of G-XXXXXXXXXX below with your ID             ║
      ╚═══════════════════════════════════════════════════════════════════════╝
    -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-XXXXXXXXXX');
    </script>

    <!-- 
      ╔═══════════════════════════════════════════════════════════════════════╗
      ║  META PIXEL CONFIGURATION                                             ║
      ║  Get your Pixel ID from: https://business.facebook.com                ║
      ║  Navigate to: Events Manager → Data Sources → Pixel ID               ║
      ║  Replace ALL instances of YOUR_PIXEL_ID below AND in the noscript    ║
      ║  fallback in the <body> section                                       ║
      ╚═══════════════════════════════════════════════════════════════════════╝
    -->
    <script>
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', 'YOUR_PIXEL_ID');
      fbq('track', 'PageView');
    </script>

    <!-- Cache-control hints (best-effort; SW still applies) -->
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <!-- iOS Splash Screen Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes" />
    <!-- iOS Splash Screens - All devices use the same high-res image, iOS will scale -->
    <!-- iPhone 15 Pro Max, 15 Plus, 14 Pro Max (1290x2796) -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3)" href="/splash-ios.jpg" />
    
    <!-- iPhone 15 Pro, 15, 14 Pro (1179x2556) -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3)" href="/splash-ios.jpg" />
    
    <!-- iPhone 14 Plus, 13 Pro Max, 12 Pro Max (1284x2778) -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3)" href="/splash-ios.jpg" />
    
    <!-- iPhone 14, 13, 13 Pro, 12, 12 Pro (1170x2532) -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)" href="/splash-ios.jpg" />
    
    <!-- iPhone 13 mini, 12 mini (1080x2340) -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)" href="/splash-ios.jpg" />
    
    <!-- iPhone 11 Pro Max, XS Max (1242x2688) -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3)" href="/splash-ios.jpg" />
    
    <!-- iPhone 11, XR (828x1792) -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2)" href="/splash-ios.jpg" />
    
    <!-- iPhone 11 Pro, XS, X (1125x2436) -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)" href="/splash-ios.jpg" />
    
    <!-- iPhone 8 Plus, 7 Plus, 6s Plus (1242x2208) -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3)" href="/splash-ios.jpg" />
    
    <!-- iPhone 8, 7, 6s, SE 2nd/3rd gen (750x1334) -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" href="/splash-ios.jpg" />
    
    <!-- iPad Pro 12.9" (2048x2732) -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2)" href="/splash-ios.jpg" />
    
    <!-- iPad Pro 11" (1668x2388) -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2)" href="/splash-ios.jpg" />
    
    <!-- iPad Air, iPad 10th gen (1640x2360) -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 820px) and (device-height: 1180px) and (-webkit-device-pixel-ratio: 2)" href="/splash-ios.jpg" />
    
    <!-- iPad 9th gen, iPad mini (1536x2048) -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)" href="/splash-ios.jpg" />

    <title>Ally by WA.I.TER - AI-Powered Aquarium Water Care</title>
    <meta name="description" content="Transform your aquarium care with Ally, the AI-powered water care assistant. Get personalized care plans and crystal-clear water effortlessly." />
    <meta name="author" content="WA.I.TER" />
    <link rel="canonical" href="https://allybywaiter.com/" />

    <!-- LLM Context Files (llmstxt.org specification) -->
    <link rel="alternate" type="text/plain" href="/llms.txt" title="LLM Context" />
    <link rel="alternate" type="text/plain" href="/llms-full.txt" title="LLM Full Context" />

    <meta property="og:title" content="Ally by WA.I.TER - AI-Powered Aquarium Water Care" />
    <meta property="og:description" content="Transform your aquarium care with Ally, the AI-powered water care assistant. Get personalized care plans and crystal-clear water effortlessly." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://allybywaiter.com/" />
    <meta property="og:image" content="https://allybywaiter.com/og-image.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@allybywaiter" />
    <meta name="twitter:image" content="https://allybywaiter.com/og-image.png" />
    
    <!-- Splash Screen Styling -->
    <style>
      #splash-screen {
        position: fixed;
        inset: 0;
        background: #000000 url('/splash-screen.png') no-repeat center center;
        background-size: cover;
        z-index: 9999;
        transition: opacity 0.5s ease-out;
      }
      #splash-screen.fade-out {
        opacity: 0;
        pointer-events: none;
      }
      #splash-logo,
      #splash-text,
      #splash-subtext,
      #splash-loader {
        display: none;
      }
      @keyframes logoFadeIn {
        to {
          opacity: 1;
          transform: scale(1);
        }
      }
      @keyframes textFadeIn {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(350%); }
      }
    </style>
  </head>

  <body>
    <!-- Meta Pixel noscript fallback -->
    <noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=YOUR_PIXEL_ID&ev=PageView&noscript=1"/></noscript>
    <!-- Skip Navigation Link for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <style>
      .skip-link {
        position: absolute;
        left: -9999px;
        top: auto;
        width: 1px;
        height: 1px;
        overflow: hidden;
        z-index: 9999;
      }
      .skip-link:focus {
        position: fixed !important;
        left: 50% !important;
        top: 8px !important;
        transform: translateX(-50%);
        width: auto !important;
        height: auto !important;
        padding: 12px 24px;
        background: #3b82f6;
        color: #ffffff;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        font-family: system-ui, -apple-system, sans-serif;
      }
    </style>
    
    <div id="splash-screen">
      <div id="splash-logo">
        <img src="/splash-logo.png" alt="Ally" width="100" height="100" />
      </div>
      <div id="splash-text">Ally</div>
      <div id="splash-subtext">by WA.I.TER</div>
      <div id="splash-loader"></div>
    </div>
    <div id="root"></div>

    <!-- Fallback content for crawlers that cannot execute JavaScript -->
    <noscript>
      <div style="font-family: Inter, system-ui, sans-serif; max-width: 800px; margin: 0 auto; padding: 40px 20px;">
        <h1>Ally by WA.I.TER - AI-Powered Water Care Assistant</h1>
        <p>Ally is your intelligent companion for maintaining crystal-clear water in aquariums, pools, spas, and ponds. Powered by advanced AI, Ally provides personalized care recommendations, automated testing analysis, and proactive alerts.</p>
        
        <h2>Key Features</h2>
        <ul>
          <li><strong>AI Photo Analysis:</strong> Snap a photo of your test strip and get instant, accurate readings</li>
          <li><strong>Voice Commands:</strong> Hands-free water care with natural language voice control</li>
          <li><strong>Smart Scheduling:</strong> Personalized maintenance schedules based on your setup</li>
          <li><strong>Proactive Alerts:</strong> Get notified before problems occur</li>
          <li><strong>Livestock Tracking:</strong> Monitor fish, corals, and plant health</li>
          <li><strong>Weather Integration:</strong> Outdoor water body care adjusted for weather conditions</li>
        </ul>

        <h2>Supported Water Bodies</h2>
        <ul>
          <li>Freshwater Aquariums</li>
          <li>Saltwater and Reef Aquariums</li>
          <li>Swimming Pools</li>
          <li>Hot Tubs and Spas</li>
          <li>Ponds and Water Features</li>
        </ul>

        <h2>Learn More</h2>
        <p>For AI-readable documentation about Ally, visit:</p>
        <ul>
          <li><a href="/llms.txt">LLM Context (Summary)</a></li>
          <li><a href="/llms-full.txt">LLM Full Context (Detailed)</a></li>
        </ul>

        <p>Contact: <a href="mailto:hello@allybywaiter.com">hello@allybywaiter.com</a></p>
        <p>Website: <a href="https://allybywaiter.com">https://allybywaiter.com</a></p>
      </div>
    </noscript>

    <!-- Pre-module recovery (runs before React bundle loads) -->
    <script>
      (function () {
        var ua = navigator.userAgent || '';
        var isIOS = /iP(hone|od|ad)/.test(ua);
        var isStandalone = (window.navigator && window.navigator.standalone) || window.matchMedia('(display-mode: standalone)').matches;

        function looksLikeStaleBundleError(err) {
          var msg = '';
          try {
            msg = String((err && (err.message || err.reason || err)) || '');
          } catch (_) {}
          return (
            /Minified React error #310/i.test(msg) ||
            /Rendered more hooks than during the previous render/i.test(msg) ||
            /Cannot destructure property/i.test(msg) ||
            /Failed to fetch dynamically imported module/i.test(msg) ||
            /Importing a module script failed/i.test(msg) ||
            /Unexpected token/i.test(msg)
          );
        }

        function shouldAttemptRecovery() {
          try {
            var key = 'pwa_recoveries_v1';
            var now = Date.now();
            var windowMs = 10 * 60 * 1000;
            var max = 2;
            var raw = sessionStorage.getItem(key);
            var arr = raw ? JSON.parse(raw) : [];
            arr = Array.isArray(arr) ? arr.filter(function (t) { return now - t < windowMs; }) : [];
            if (arr.length >= max) return false;
            arr.push(now);
            sessionStorage.setItem(key, JSON.stringify(arr));
            return true;
          } catch (_) {
            return true;
          }
        }

        function clearAndReload() {
          if (!shouldAttemptRecovery()) return;

          var bust = '_cb=' + Date.now();
          var nextUrl = window.location.href;
          nextUrl += (nextUrl.indexOf('?') === -1 ? '?' : '&') + bust;

          try {
            if ('serviceWorker' in navigator) {
              navigator.serviceWorker.getRegistrations().then(function (regs) {
                regs.forEach(function (r) { try { r.unregister(); } catch (_) {} });
              });
            }
          } catch (_) {}

          try {
            if (window.caches && caches.keys) {
              caches.keys().then(function (keys) {
                return Promise.all(keys.map(function (k) { return caches.delete(k); }));
              });
            }
          } catch (_) {}

          setTimeout(function () { window.location.replace(nextUrl); }, 250);
        }

        function onGlobalError(e) {
          var err = (e && (e.error || e.reason)) || e;
          if (!looksLikeStaleBundleError(err)) return;
          if (isIOS && isStandalone) clearAndReload();
        }

        window.addEventListener('error', onGlobalError);
        window.addEventListener('unhandledrejection', onGlobalError);
      })();
    </script>
    <script type="module" src="/src/main.tsx"></script>

    <script>
      // Hide splash screen when React app signals it's ready
      function hideSplash() {
        var splash = document.getElementById('splash-screen');
        if (splash && !splash.classList.contains('fade-out')) {
          splash.classList.add('fade-out');
          setTimeout(function() {
            splash.remove();
          }, 400);
        }
      }
      // Expose globally for React to call
      window.hideSplash = hideSplash;
      // Fallback: hide after max 3 seconds if React hasn't loaded
      setTimeout(hideSplash, 3000);
    </script>
  </body>
</html>